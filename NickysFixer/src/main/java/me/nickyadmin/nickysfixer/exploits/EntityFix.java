package me.nickyadmin.nickysfixer.exploits;

import me.nickyadmin.nickysfixer.Main;
import org.bukkit.Chunk;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.entity.Entity;
import org.bukkit.entity.FallingBlock;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityChangeBlockEvent;

public class EntityFix implements Listener {
        private final Main plugin;

        public EntityFix(Main plugin) {
            this.plugin = plugin;
        }

    @EventHandler
    private void onFallingChange(EntityChangeBlockEvent event) {
        FileConfiguration config = plugin.getConfig();
        if (config.getBoolean("fix-falling-entities-crash")) {
            Chunk chunk = event.getBlock().getChunk();
            int limit = 0;
            for (Entity entity : chunk.getEntities()) {
                if (entity instanceof FallingBlock) {
                    if (limit < config.getInt("max-per-chunk")) {
                        limit++;
                        continue;
                    } else {
                        entity.remove();
                        break;
                    }
                }
            }
        }
    }
}
